PROJECT (trax)

CMAKE_MINIMUM_REQUIRED(VERSION 2.6)
GET_FILENAME_COMPONENT(PROJECT_ROOT . ABSOLUTE)

SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -fPIC")
SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fPIC")

SET(CMAKE_MODULE_PATH ${PROJECT_ROOT}/cmake)

IF (WIN32 OR WIN64)
    SET(LIBRARIES trax)
ELSE ()
    SET(LIBRARIES trax m)
    ADD_EXECUTABLE(test lib/test.c)
ENDIF ()

INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/lib)

ADD_LIBRARY(trax SHARED lib/trax.c lib/region.c lib/strmap.c lib/message.c)

ADD_LIBRARY(traxstatic STATIC lib/trax.c lib/region.c lib/strmap.c lib/message.c)

ADD_EXECUTABLE(static trackers/static.c)

TARGET_LINK_LIBRARIES(static ${LIBRARIES})

TARGET_LINK_LIBRARIES(test ${LIBRARIES})

SET (BUILD_CAMSHIFT FALSE CACHE BOOL "Build an example using OpenCV CamShift tracker")

IF (BUILD_CAMSHIFT)
	FIND_PACKAGE(OpenCV REQUIRED)
	INCLUDE_DIRECTORIES(AFTER ${OpenCV_INCLUDE_DIR})
	ADD_EXECUTABLE(camshift trackers/camshift.c)
	TARGET_LINK_LIBRARIES(camshift ${OpenCV_LIBS} ${LIBRARIES})
ENDIF (BUILD_CAMSHIFT)

SET (BUILD_CLIENT FALSE CACHE BOOL "Build a client executable")

IF (BUILD_CLIENT)
IF (WIN32)
    ADD_EXECUTABLE(traxclient client/client.cpp client/process.cpp client/threads.c client/getopt_win.c)
ELSE (WIN32)
    ADD_EXECUTABLE(traxclient client/client.cpp client/process.cpp client/threads.c)
ENDIF (WIN32)
    TARGET_LINK_LIBRARIES(traxclient ${LIBRARIES})
ENDIF (BUILD_CLIENT)

IF ("${CMAKE_CXX_COMPILER_ID}" STREQUAL "GNU")
	SET(CMAKE_CXX_FLAGS -pthread)
ENDIF ()

IF (WIN32)
	INSTALL(TARGETS trax RUNTIME DESTINATION ${CMAKE_INSTALL_PREFIX} LIBRARY DESTINATION ${CMAKE_INSTALL_PREFIX} ARCHIVE DESTINATION ${CMAKE_INSTALL_PREFIX})
	INSTALL(FILES lib/trax.h DESTINATION include)
    IF (BUILD_CLIENT)
    	#INSTALL(TARGETS traxclient RUNTIME DESTINATION bin)
    ENDIF (BUILD_CLIENT)
ENDIF (WIN32)

IF (UNIX)
	INSTALL(TARGETS trax LIBRARY DESTINATION lib)
	INSTALL(FILES lib/trax.h DESTINATION include)
    IF (BUILD_CLIENT)
    	INSTALL(TARGETS traxclient RUNTIME DESTINATION bin)
    ENDIF (BUILD_CLIENT)
ENDIF (UNIX)

SET(CPACK_PACKAGE_DESCRIPTION_SUMMARY "TraX")
SET(CPACK_PACKAGE_VENDOR "TraX Maintainers")
SET(CPACK_PACKAGE_DESCRIPTION_FILE "${CMAKE_CURRENT_SOURCE_DIR}/README.md")
SET(CPACK_GENERATOR "ZIP")
INCLUDE(CPack)
